# üéØ Toolhouse CLI Best Practices\n\n> **Professional workflows and proven patterns** - Based on industry research and community feedback\n\n## üöÄ Quick Reference\n\n### Essential Daily Commands\n```bash\n# The Big Three - use these every day\nth run agent.yaml          # Test locally (always do this first)\nth validate agent.yaml     # Check syntax and configuration\nth deploy agent.yaml       # Deploy to production\n\n# Authentication & Status\nth login                   # Authenticate once\nth whoami                  # Check current user\nth logout                  # Sign out\n\n# Management & Monitoring\nth agents list             # View deployed agents\nth logs agent-name --follow # Live logs\nth runs list              # Recent executions\n```\n\n## üèóÔ∏è Project Structure Best Practices\n\n### Recommended Directory Layout\n```\nyour-project/\n‚îú‚îÄ‚îÄ agents/                 # All .th files here\n‚îÇ   ‚îú‚îÄ‚îÄ production.yaml    # Production agent\n‚îÇ   ‚îú‚îÄ‚îÄ staging.yaml       # Staging/testing\n‚îÇ   ‚îî‚îÄ‚îÄ development.yaml   # Local development\n‚îú‚îÄ‚îÄ scripts/               # Automation scripts\n‚îÇ   ‚îú‚îÄ‚îÄ test-all.sh       # Test all agents\n‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh          # Deployment script\n‚îÇ   ‚îî‚îÄ‚îÄ validate.sh        # Validation script\n‚îú‚îÄ‚îÄ tests/                 # Test scenarios\n‚îÇ   ‚îú‚îÄ‚îÄ scenarios.yaml    # Test cases\n‚îÇ   ‚îî‚îÄ‚îÄ expected-outputs/  # Expected results\n‚îú‚îÄ‚îÄ .env.example          # Environment template\n‚îú‚îÄ‚îÄ .gitignore            # Git ignore (include .env)\n‚îî‚îÄ‚îÄ README.md             # Project documentation\n```\n\n### File Naming Conventions\n```bash\n# Good naming patterns\ncustomer-support.yaml      # Descriptive, kebab-case\ndata-analyzer-v2.yaml      # Version when needed\nproduction-chatbot.yaml    # Environment prefix\n\n# Avoid these patterns\nuntitled.yaml              # Too generic\ntest.yaml                  # Unclear purpose\nmy_agent.yaml              # Inconsistent casing\n```\n\n## üîÑ Development Workflow\n\n### The Professional Development Loop\n\n#### 1. Local Development First\n```bash\n# Always start local - saves time and money\nth run agent.yaml --input \"test message\"\n\n# Use specific test inputs\nth run agent.yaml --input \"$(cat tests/test-input.txt)\"\n\n# Validate before deploying\nth validate agent.yaml\n```\n\n#### 2. Environment Progression\n```bash\n# Development ‚Üí Staging ‚Üí Production\nth run development.yaml    # Local testing\nth deploy staging.yaml     # Team testing\nth deploy production.yaml  # Live deployment\n```\n\n#### 3. Version Control Integration\n```bash\n# Git workflow with validation\ngit add agents/\nth validate agents/*.yaml  # Validate all before commit\ngit commit -m \"feat: improve customer support prompts\"\ngit push\n```\n\n## üîê Security & Secrets Best Practices\n\n### Secret Management\n```bash\n# Store secrets securely in Toolhouse\nth secrets add OPENAI_API_KEY=sk-...\nth secrets add DATABASE_URL=postgresql://...\nth secrets add SLACK_TOKEN=xoxb-...\n\n# List secrets (names only, values hidden)\nth secrets list\n\n# Update secrets\nth secrets set OPENAI_API_KEY=sk-new-key...\n\n# Remove unused secrets\nth secrets remove OLD_API_KEY\n```\n\n### Environment Variables in Agents\n```yaml\n# agent.yaml - Reference secrets securely\ntitle: \"Secure Agent\"\nprompt: |\n  You are a helpful assistant.\n  Database connection: ${DATABASE_URL}\n  \nvars:\n  api_key: \"${OPENAI_API_KEY}\"\n  environment: \"${ENVIRONMENT:production}\"\n  debug: \"${DEBUG:false}\"\n```\n\n### .env File Management\n```bash\n# .env.example (commit this)\nTOOLHOUSE_API_KEY=your_key_here\nOPENAI_API_KEY=your_openai_key\nENVIRONMENT=development\n\n# .env (never commit this)\nTOOLHOUSE_API_KEY=th_abc123...\nOPENAI_API_KEY=sk-proj-...\nENVIRONMENT=development\n\n# .gitignore (always include)\n.env\n.env.local\n.env.*.local\n```\n\n## üß™ Testing Strategies\n\n### Automated Testing Patterns\n```bash\n# Test script example\n#!/bin/bash\n# test-agent.sh\n\nset -e\n\necho \"üß™ Testing agent configuration...\"\n\n# Validate syntax\nth validate agent.yaml\n\n# Test scenarios\ntest_cases=(\n  \"Hello, how can you help?\"\n  \"What are your capabilities?\"\n  \"Can you process data files?\"\n)\n\nfor test_case in \"${test_cases[@]}\"; do\n  echo \"Testing: $test_case\"\n  result=$(th run agent.yaml --input \"$test_case\")\n  \n  # Check for error indicators\n  if echo \"$result\" | grep -q \"error\\|Error\\|ERROR\"; then\n    echo \"‚ùå Test failed: $test_case\"\n    exit 1\n  fi\n  \n  echo \"‚úÖ Test passed\"\ndone\n\necho \"üéâ All tests passed!\"\n```\n\n### Regression Testing\n```yaml\n# tests/scenarios.yaml\ntest_scenarios:\n  - name: \"Basic greeting\"\n    input: \"Hello, how are you?\"\n    expected_keywords: [\"hello\", \"help\", \"assist\"]\n    \n  - name: \"Data processing\"\n    input: \"Can you analyze this CSV data?\"\n    expected_keywords: [\"csv\", \"analyze\", \"data\"]\n    \n  - name: \"Error handling\"\n    input: \"Invalid request 123!@#\"\n    should_not_contain: [\"error\", \"crash\", \"fail\"]\n```\n\n## üìä Monitoring & Observability\n\n### Log Management\n```bash\n# Real-time monitoring\nth logs customer-support --follow\n\n# Historical logs\nth logs customer-support --since 24h\nth logs customer-support --since \"2025-01-01\"\n\n# Filter by level\nth logs customer-support --level error\nth logs customer-support --level debug\n\n# Export logs for analysis\nth logs customer-support --since 7d --format json > logs.json\n```\n\n### Performance Monitoring\n```bash\n# Check agent run history\nth runs list --agent customer-support\n\n# Get detailed run information\nth runs get <run-id>\n\n# Monitor for failures\nth runs list --status failed --since 24h\n```\n\n### Cost Monitoring\n```bash\n# Track agent run usage\nth usage --agent customer-support --period month\n\n# Monitor credit consumption\nth account status\n\n# Set up alerts (if available)\nth alerts create --threshold 80% --type credit-usage\n```\n\n## üöÄ Deployment Best Practices\n\n### Pre-deployment Checklist\n```bash\n# 1. Validate configuration\nth validate agent.yaml\n\n# 2. Test locally\nth run agent.yaml --input \"test scenario\"\n\n# 3. Check authentication\nth whoami\n\n# 4. Verify secrets are set\nth secrets list\n\n# 5. Deploy\nth deploy agent.yaml\n```\n\n### Deployment Strategies\n\n#### Blue-Green Deployment\n```bash\n# Deploy new version alongside old\nth deploy agent-v2.yaml --name agent-green\n\n# Test new version\ncurl -X POST https://agents.toolhouse.ai/agent-green-id \\\n  -d '{\"message\": \"test\"}'\n\n# Switch traffic (update DNS/load balancer)\n# Remove old version\nth agents delete agent-blue\n```\n\n#### Rolling Deployment\n```bash\n# Gradual rollout script\n#!/bin/bash\nfor region in us-west eu-west asia-east; do\n  echo \"Deploying to $region...\"\n  th deploy agent.yaml --region $region\n  sleep 60  # Wait between regions\ndone\n```\n\n### Environment-Specific Deployment\n```bash\n# Development environment\nth deploy agent.yaml --public=false --environment=dev\n\n# Staging environment  \nth deploy agent.yaml --public=false --environment=staging\n\n# Production environment\nth deploy agent.yaml --public=false --environment=production\n```\n\n## üîß Advanced Configuration\n\n### Agent Configuration Patterns\n\n#### Multi-Environment Agent\n```yaml\n# agent.yaml\ntitle: \"${AGENT_NAME:Customer Support Agent}\"\nprompt: |\n  You are a ${ENVIRONMENT:production} customer support agent.\n  \n  Environment: ${ENVIRONMENT}\n  Debug mode: ${DEBUG:false}\n  \n  ${ENVIRONMENT_SPECIFIC_INSTRUCTIONS}\n  \nmodel: \"${MODEL:@openai/gpt-4o-mini}\"\npublic: ${PUBLIC:false}\nvars:\n  environment: \"${ENVIRONMENT:production}\"\n  api_endpoint: \"${API_ENDPOINT:https://api.example.com}\"\n  timeout: \"${TIMEOUT:30}\"\n```\n\n#### Conditional Tool Loading\n```yaml\n# Only load certain tools in specific environments\nbundles:\n  - \"rag\"  # Always available\n  - \"${DEBUG:false}\" == \"true\" ? \"debug-tools\" : \"\"\n  - \"${ENVIRONMENT}\" == \"production\" ? \"monitoring\" : \"testing\"\n```\n\n### Advanced CLI Usage\n\n#### Batch Operations\n```bash\n# Deploy multiple agents\nfor agent in agents/*.yaml; do\n  echo \"Deploying $agent...\"\n  th deploy \"$agent\"\ndone\n\n# Validate all agents\nth validate agents/*.yaml\n\n# Update all agents with new secrets\nth secrets set NEW_API_KEY=value\nfor agent in agents/*.yaml; do\n  th deploy \"$agent\"  # Redeploy to pick up new secrets\ndone\n```\n\n#### Parallel Processing\n```bash\n# Test multiple agents in parallel\n#!/bin/bash\ntest_agent() {\n  local agent=$1\n  echo \"Testing $agent...\"\n  th run \"$agent\" --input \"test\" > \"results/${agent%.yaml}.log\" 2>&1\n}\n\nexport -f test_agent\nls agents/*.yaml | xargs -n1 -P4 bash -c 'test_agent \"$@\"' _\n```\n\n## üîç Troubleshooting Guide\n\n### Common Issues & Solutions\n\n#### Authentication Problems\n```bash\n# Problem: \"Authentication failed\"\n# Solution:\nth logout\nth login\n\n# Problem: \"API key not found\"\n# Check stored credentials:\ncat ~/.toolhouse/config.json\n\n# Regenerate API key in dashboard if needed\n```\n\n#### Deployment Failures\n```bash\n# Problem: \"Invalid configuration\"\n# Debug steps:\nth validate agent.yaml  # Check syntax\nyamlint agent.yaml      # Advanced YAML validation\n\n# Problem: \"Secrets not found\"\n# Check secrets:\nth secrets list\nth secrets add MISSING_KEY=value\n```\n\n#### Performance Issues\n```bash\n# Problem: \"Agent runs slowly\"\n# Check model and optimize:\n# - Use faster models for simple tasks\n# - Optimize prompts for brevity\n# - Reduce tool calls in prompt\n\n# Monitor performance:\nth logs agent-name --since 1h | grep \"execution_time\"\n```\n\n### Debug Mode\n```bash\n# Enable verbose output\nexport TH_DEBUG=true\nth run agent.yaml\n\n# Capture full request/response\nth run agent.yaml --debug --output debug.log\n```\n\n## üìö Integration Patterns\n\n### CI/CD Integration\n\n#### GitHub Actions\n```yaml\n# .github/workflows/deploy-agent.yml\nname: Deploy Toolhouse Agent\non:\n  push:\n    branches: [main]\n    paths: ['agents/**']\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '18'\n          \n      - name: Install Toolhouse CLI\n        run: npm install -g @toolhouseai/cli\n        \n      - name: Validate Agents\n        run: |\n          for agent in agents/*.yaml; do\n            th validate \"$agent\"\n          done\n          \n      - name: Deploy to Staging\n        if: github.ref == 'refs/heads/develop'\n        run: th deploy agents/staging.yaml\n        env:\n          TOOLHOUSE_API_KEY: ${{ secrets.TOOLHOUSE_API_KEY_STAGING }}\n          \n      - name: Deploy to Production\n        if: github.ref == 'refs/heads/main'\n        run: th deploy agents/production.yaml\n        env:\n          TOOLHOUSE_API_KEY: ${{ secrets.TOOLHOUSE_API_KEY_PROD }}\n```\n\n#### Docker Integration\n```dockerfile\n# Dockerfile\nFROM node:18-alpine\n\nRUN npm install -g @toolhouseai/cli\n\nWORKDIR /app\nCOPY agents/ ./agents/\nCOPY scripts/ ./scripts/\n\nCMD [\"./scripts/deploy.sh\"]\n```\n\n### VS Code Integration\n\n#### Workspace Settings\n```json\n// .vscode/settings.json\n{\n  \"yaml.schemas\": {\n    \"https://raw.githubusercontent.com/toolhouseai/schema/main/agent.json\": \"agents/*.yaml\"\n  },\n  \"files.associations\": {\n    \"*.th\": \"yaml\"\n  },\n  \"editor.formatOnSave\": true,\n  \"yaml.format.enable\": true\n}\n```\n\n#### Tasks Configuration\n```json\n// .vscode/tasks.json\n{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"Test All Agents\",\n      \"type\": \"shell\",\n      \"command\": \"./scripts/test-all.sh\",\n      \"group\": \"test\",\n      \"presentation\": {\n        \"echo\": true,\n        \"reveal\": \"always\"\n      }\n    },\n    {\n      \"label\": \"Deploy Production\",\n      \"type\": \"shell\",\n      \"command\": \"th deploy agents/production.yaml\",\n      \"group\": \"build\"\n    }\n  ]\n}\n```\n\n## üéØ Performance Optimization\n\n### Model Selection Strategy\n```yaml\n# Choose models based on use case\n\n# For simple tasks (fast + cheap)\nmodel: \"@openai/gpt-4o-mini\"\n\n# For complex reasoning (slower + expensive)\nmodel: \"@openai/o1-preview\"\n\n# For speed (with Groq)\nmodel: \"@groq/llama-3.3-70b-versatile\"\n\n# For latest features\nmodel: \"@anthropic/claude-sonnet-4-20250514\"\n```\n\n### Prompt Optimization\n```yaml\n# Inefficient prompt (verbose, multiple tool calls)\nprompt: |\n  You are a helpful assistant. Please be very detailed in your responses.\n  Always search the knowledge base first, then search the web if needed,\n  then check the database, then format the response nicely...\n\n# Optimized prompt (concise, clear)\nprompt: |\n  You are a customer support agent. Priority order:\n  1. Search knowledge base\n  2. If no answer found, state clearly\n  3. Offer to escalate to human\n```\n\n### Resource Management\n```bash\n# Monitor resource usage\nth account usage --detailed\n\n# Optimize for cost\n# - Use smaller models for simple tasks\n# - Cache results when possible\n# - Minimize tool calls per run\n\n# Scale based on demand\nth agents scale customer-support --instances 3  # If available\n```\n\n---\n\n## üèÜ Summary: The Golden Rules\n\n1. **üß™ Always test locally first** - `th run` before `th deploy`\n2. **üîê Keep secrets secure** - Use `th secrets`, never hardcode\n3. **üìù Validate before deploy** - `th validate` catches errors early\n4. **üîÑ Use version control** - Git + proper commit messages\n5. **üìä Monitor in production** - Use `th logs` and `th runs`\n6. **üéØ Optimize for your use case** - Right model + concise prompts\n7. **üöÄ Automate repetitive tasks** - Scripts + CI/CD integration\n8. **üìö Document your setup** - Future you will thank you\n\n**Following these practices will make you a Toolhouse CLI power user and help you build reliable, maintainable AI agents!**"